<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="All greatness comes from the beginning of courage" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="所有的伟大,源于一个勇敢的开始">
<meta property="og:url" content="https://williams-hao.github.io/index.html">
<meta property="og:site_name" content="所有的伟大,源于一个勇敢的开始">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="所有的伟大,源于一个勇敢的开始">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://williams-hao.github.io/"/>





  <title>所有的伟大,源于一个勇敢的开始</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">所有的伟大,源于一个勇敢的开始</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">所有的伟大,源于一个勇敢的开始</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://williams-hao.github.io/2017/06/04/Logistic回归分类算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Williams-Hao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="所有的伟大,源于一个勇敢的开始">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/04/Logistic回归分类算法/" itemprop="url">Logistic回归分类算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-04T14:39:42+08:00">
                2017-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习-分类/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习-分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Logistic回归"><a href="#Logistic回归" class="headerlink" title="Logistic回归"></a>Logistic回归</h1><hr>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><h3 id="sigmoid函数"><a href="#sigmoid函数" class="headerlink" title="sigmoid函数"></a>sigmoid函数</h3><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/34ef0bf30a2cd7e90e87221cfc796dcf4f265d56" alt="sigmoid"><br><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Logistic-curve.svg/320px-Logistic-curve.svg.png" alt=""></p>
<ul>
<li>S(x)’</li>
</ul>
<p><img src="http://img.blog.csdn.net/20170326113104537?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2FpbW91c2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>sigmoid函数为线性函数引入了非线性变化,让0到1之间的变化不是断崖式变化.</p>
<h3 id="线性回归"><a href="#线性回归" class="headerlink" title="线性回归"></a>线性回归</h3><p>有xi=[x1,x2,…,xn]—-yi<br>f(x) = a0+a1<em>x1+a2</em>x2+…+an<em>Xn<br>用f(x)去拟合y的变化<br><em>*实际上就是求一组参数a0….an</em></em></p>
<ul>
<li>cost Function J(ceta) : 用来度量模型预测值与真实值之间的差距。</li>
</ul>
<p><strong>这个值越好,就说明模型越接近真实情况</strong></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>线性回归后的结果再经过sigmoid函数,即：</p>
<pre><code>z(x) =  a0+a1x1+a2x2+...+anXn
f(x) = sigmoid(z)
</code></pre><p><img src="http://ww1.sinaimg.cn/large/75544e9fly1fg96xqgxarj20l30hjjs0.jpg" alt=""></p>
<ul>
<li>Cost(h(x),y)综合起来：</li>
</ul>
<p><img src="http://img.blog.csdn.net/20140716153740866" alt=""></p>
<p>最终的J:<br><img src="http://img.blog.csdn.net/20140716153733362" alt=""></p>
<p>梯度下降法更新参数值：<br><img src="http://img.my.csdn.net/uploads/201407/16/1405496972_1821.png" alt=""><br><img src="http://img.my.csdn.net/uploads/201407/16/1405496975_3372.png" alt=""></p>
<p><strong>梯度上升法则是一个负号的关系</strong></p>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><ul>
<li>构建数据集矩阵和标签列表</li>
<li>训练分类器</li>
<li>将测试数据分类</li>
</ul>
<h3 id="输入"><a href="#输入" class="headerlink" title="输入:"></a>输入:</h3><blockquote>
<p>待分类向量</p>
<p>dataSet向量集合(有签[A,B,C,D,E,F…])  </p>
<p>Label =[A,B,C,D,E,F… ]</p>
</blockquote>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><ul>
<li>优点: 计算代价不高、易于实现和理解</li>
<li>缺点: 容易欠拟合、分类精度不高</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div></pre></td><td class="code"><pre><div class="line"><span class="string">'''</span></div><div class="line">created at 2017-05-02</div><div class="line">author:Hao Jiawei</div><div class="line">'''</div><div class="line"><span class="comment"># -*- coding:utf8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 重置数据点的label 把以(0.0,6.0)为圆心, 4为半径的圆作为2类数据的分界线</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">circleSign</span><span class="params">(x, y)</span>:</span></div><div class="line">    <span class="comment"># print x, y</span></div><div class="line">    sq = (<span class="number">0.0</span> - x)**<span class="number">2</span> + (<span class="number">6.0</span> - y)**<span class="number">2</span></div><div class="line">    <span class="comment"># print sq</span></div><div class="line">    <span class="keyword">if</span> sq &gt; <span class="number">16</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadData</span><span class="params">()</span>:</span></div><div class="line">    dataMat = []</div><div class="line">    labelMat = []</div><div class="line">    fr = open(</div><div class="line">        <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch05\\testSet.txt'</span>)</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> fr.readlines():</div><div class="line">        lineArr = line.strip().split()</div><div class="line">        <span class="comment"># dataMat.append([1.0, float(lineArr[0]), float(lineArr[1])])</span></div><div class="line">        <span class="comment"># # labelMat.append(int(lineArr[2]))</span></div><div class="line">        <span class="comment"># labelMat.append(circleSign(float(lineArr[0]), float(lineArr[1])))</span></div><div class="line"></div><div class="line">        <span class="comment"># 尝试用圆方程拟合曲线</span></div><div class="line">        dataMat.append([float(lineArr[<span class="number">0</span>])**<span class="number">2</span>, float(lineArr[<span class="number">1</span>])</div><div class="line">                        ** <span class="number">2</span>, float(lineArr[<span class="number">0</span>]), float(lineArr[<span class="number">1</span>]), <span class="number">1.0</span>])</div><div class="line">        labelMat.append(circleSign(float(lineArr[<span class="number">0</span>]), float(lineArr[<span class="number">1</span>])))</div><div class="line"></div><div class="line">    <span class="keyword">return</span> dataMat, labelMat</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sigmoid</span><span class="params">(inX)</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="number">1.0</span> / (<span class="number">1</span> + exp(-inX))</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradAscent</span><span class="params">(dataMatIn, classLabels)</span>:</span></div><div class="line">    dataMatrix = mat(dataMatIn)</div><div class="line">    labelMat = mat(classLabels).transpose()</div><div class="line">    m, n = shape(dataMatrix)</div><div class="line">    alpha = <span class="number">0.001</span></div><div class="line">    maxCycles = <span class="number">50000</span></div><div class="line">    weights = ones((n, <span class="number">1</span>))</div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(maxCycles):</div><div class="line">        h = sigmoid(dataMatrix * weights)</div><div class="line">        error = (labelMat - h)</div><div class="line">        <span class="string">'''</span></div><div class="line">            这里存在一个公式推导</div><div class="line">            推导损失函数的梯度</div><div class="line">            http://blog.csdn.net/lu597203933/article/details/38468303</div><div class="line">        '''</div><div class="line">        weights = weights + alpha * dataMatrix.transpose() * error</div><div class="line">    <span class="keyword">return</span> weights</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    随机梯度上升法0.0</div><div class="line">    参数weight type:numpy.ndarray shape:(5L,)</div><div class="line">    plotBestFit 函数需要的参数是 type:numpy.ndarray shape:(5L, 1L)</div><div class="line">    所以需要reshape操作</div><div class="line">    如果只训练数据个数次数,效果很差,连圆都画不出来,</div><div class="line">    在外面加了100此循环,有个双曲线,加到10000次,才拟合出椭圆</div><div class="line">'''</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">stocGrandAscent0</span><span class="params">(dataMatrix, classLabels)</span>:</span></div><div class="line">    m, n = shape(dataMatrix)</div><div class="line">    alpha = <span class="number">0.01</span></div><div class="line">    weights = ones(n)</div><div class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">150</span>):</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</div><div class="line">            h = sigmoid(sum(dataMatrix[i] * weights))</div><div class="line">            error = classLabels[i] - h</div><div class="line">            weights = weights + alpha * dataMatrix[i] * error</div><div class="line">    <span class="keyword">return</span> weights</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    随机梯度上升0.1</div><div class="line">    update: 1.增加了迭代参数</div><div class="line">            2.每一轮迭代随机选数据进行训练参数</div><div class="line">            3.训练步长每次递减</div><div class="line">'''</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">stocGrandAscent1</span><span class="params">(dataMatrix, classLabels, numIter=<span class="number">150</span>)</span>:</span></div><div class="line">    m, n = shape(dataMatrix)</div><div class="line">    weights = ones(n)</div><div class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(numIter):</div><div class="line">        dataIndex = range(m)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</div><div class="line">            alpha = <span class="number">4</span> / (<span class="number">1.0</span> + i + j) + <span class="number">0.01</span></div><div class="line">            randIndex = int(random.uniform(<span class="number">0</span>, len(dataIndex)))</div><div class="line">            h = sigmoid(sum(dataMatrix[randIndex] * weights))</div><div class="line">            error = classLabels[randIndex] - h</div><div class="line">            weights = weights + alpha * dataMatrix[randIndex] * error</div><div class="line">            <span class="keyword">del</span>(dataIndex[randIndex])</div><div class="line">    <span class="keyword">return</span> weights</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">plotBestFit</span><span class="params">(weights)</span>:</span></div><div class="line">    w = weights</div><div class="line">    dataMat, labelMat = loadData()</div><div class="line">    dataArr = array(dataMat)</div><div class="line">    n = shape(dataArr)[<span class="number">0</span>]</div><div class="line">    xcord1 = []</div><div class="line">    ycord1 = []</div><div class="line">    xcord2 = []</div><div class="line">    ycord2 = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        <span class="keyword">if</span> int(labelMat[i]) == <span class="number">1</span>:</div><div class="line">            <span class="comment"># xcord1.append(dataArr[i, 1])</span></div><div class="line">            <span class="comment"># ycord1.append(dataArr[i, 2])</span></div><div class="line">            xcord1.append(dataArr[i, <span class="number">2</span>])</div><div class="line">            ycord1.append(dataArr[i, <span class="number">3</span>])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># xcord2.append(dataArr[i, 1])</span></div><div class="line">            <span class="comment"># ycord2.append(dataArr[i, 2])</span></div><div class="line">            xcord2.append(dataArr[i, <span class="number">2</span>])</div><div class="line">            ycord2.append(dataArr[i, <span class="number">3</span>])</div><div class="line">    fig = plt.figure()</div><div class="line">    ax = fig.add_subplot(<span class="number">111</span>)</div><div class="line">    ax.scatter(xcord1, ycord1, s=<span class="number">30</span>, c=<span class="string">'red'</span>, marker=<span class="string">'s'</span>)</div><div class="line">    ax.scatter(xcord2, ycord2, s=<span class="number">30</span>, c=<span class="string">'green'</span>)</div><div class="line">    <span class="comment"># x = arange(-3.0, 3.0, 0.1)</span></div><div class="line">    <span class="comment"># y = (-weights[0]-weights[1]*x)/weights[2]</span></div><div class="line">    <span class="comment"># x = arange(-2.5, 15.0, 0.1)</span></div><div class="line">    <span class="comment">#y = (-weights[0]-weights[1]*x)</span></div><div class="line"></div><div class="line">    x = y = arange(<span class="number">-15.0</span>, <span class="number">15.0</span>, <span class="number">0.1</span>)</div><div class="line">    x, y = meshgrid(x, y)</div><div class="line">    <span class="keyword">print</span> <span class="string">'x.shape:&#123;&#125;'</span>.format(x.shape)</div><div class="line">    <span class="keyword">print</span> <span class="string">'y.shape:&#123;&#125;'</span>.format(y.shape)</div><div class="line">    <span class="comment">#ax.plot(x, y)</span></div><div class="line"></div><div class="line">    plt.contour(x, y,</div><div class="line">                w[<span class="number">0</span>] * (x**<span class="number">2</span>) + w[<span class="number">1</span>] * (y**<span class="number">2</span>) + w[<span class="number">2</span>] * x + w[<span class="number">3</span>] * y + w[<span class="number">4</span>], [<span class="number">0</span>])</div><div class="line">    plt.xlabel(<span class="string">'X1'</span>)</div><div class="line">    plt.ylabel(<span class="string">'X2'</span>)</div><div class="line">    plt.show()</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classifyVector</span><span class="params">(inX, weights)</span>:</span></div><div class="line">    prob = sigmoid(sum(inX * weights))</div><div class="line">    <span class="keyword">if</span> prob &gt; <span class="number">0.5</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">colicTest</span><span class="params">()</span>:</span></div><div class="line">    frTrain = open(</div><div class="line">        <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch05\\horseColicTraining.txt'</span>)</div><div class="line">    frTest = open(</div><div class="line">        <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch05\\horseColicTest.txt'</span>)</div><div class="line">    trainingSet = []</div><div class="line">    trainingLabels = []</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> frTrain.readlines():</div><div class="line">        currLine = line.strip().split(<span class="string">'\t'</span>)</div><div class="line">        lineArr = []</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">21</span>):</div><div class="line">            lineArr.append(float(currLine[i]))</div><div class="line">        trainingSet.append(lineArr)</div><div class="line">        trainingLabels.append(float(currLine[<span class="number">21</span>]))</div><div class="line">    trainWeights = stocGrandAscent1(array(trainingSet), trainingLabels, <span class="number">500</span>)</div><div class="line">    errorCount = <span class="number">0</span></div><div class="line">    numTestVec = <span class="number">0.0</span></div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> frTest.readlines():</div><div class="line">        numTestVec += <span class="number">1.0</span></div><div class="line">        currLine = line.strip().split(<span class="string">'\t'</span>)</div><div class="line">        lineArr = []</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">21</span>):</div><div class="line">            lineArr.append(float(currLine[i]))</div><div class="line">        classifyRes = int(classifyVector(array(lineArr), trainWeights))</div><div class="line">        <span class="keyword">if</span> classifyRes != int(currLine[<span class="number">21</span>]):</div><div class="line">            errorCount += <span class="number">1</span></div><div class="line">    errorRate = float(errorCount) / numTestVec</div><div class="line">    <span class="keyword">print</span> <span class="string">'the error rate of this test is :&#123;&#125; '</span>.format(errorRate)</div><div class="line">    <span class="keyword">return</span> errorRate</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiTest</span><span class="params">()</span>:</span></div><div class="line">    numTests = <span class="number">10</span></div><div class="line">    errorSum = <span class="number">0.0</span></div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(numTests):</div><div class="line">        errorSum += colicTest()</div><div class="line">    <span class="keyword">print</span> <span class="string">'after &#123;&#125; iterations the average error rate is : &#123;&#125;'</span>.format(numTests, errorSum / float(numTests))</div></pre></td></tr></table></figure>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>5W次迭代<br><img src="http://ww1.sinaimg.cn/large/75544e9fly1fg97ckh56mj211y0ho74q.jpg" alt=""></p>
<p>随机0 150次<br><img src="http://ww1.sinaimg.cn/large/75544e9fly1fg97e7y4vyj211y0ho3z7.jpg" alt=""></p>
<p>随机1 150次<br><img src="http://ww1.sinaimg.cn/large/75544e9fly1fg97eoz4ptj211y0hoq3e.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://williams-hao.github.io/2017/06/03/朴素贝叶斯分类算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Williams-Hao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="所有的伟大,源于一个勇敢的开始">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/朴素贝叶斯分类算法/" itemprop="url">朴素贝叶斯分类算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T17:03:33+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习-分类/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习-分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h1><hr>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>贝叶斯定理是关于随机事件 A 和 B 的条件概率：<br><img src="http://upload.wikimedia.org/math/4/6/b/46b680c10ac90b0782843f4bbd0b4a95.png" alt=""><br><a href="http://blog.csdn.net/kesalin/article/details/40370325/" target="_blank" rel="external">概率定义;贝叶斯定义</a>—转自 (<a href="http://kesalin.github.io/" target="_blank" rel="external">http://kesalin.github.io/</a>)</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><strong>根据已有的数据求出某类别下的数据出现的条件概率，运用贝叶斯原理求出在待分类数据条件下属于哪个类别概率最大</strong></p>
<p>这篇文章写得不错:!(<a href="http://www.cnblogs.com/leoo2sk/archive/2010/09/17/naive-bayesian-classifier.html" target="_blank" rel="external">http://www.cnblogs.com/leoo2sk/archive/2010/09/17/naive-bayesian-classifier.html</a>)</p>
<h2 id="p-类别i-A-p-A-类别i-p-类别i-p-A"><a href="#p-类别i-A-p-A-类别i-p-类别i-p-A" class="headerlink" title="p(类别i| A) = p(A|类别i)* p(类别i) / p(A)"></a>p(类别i| A) = p(A|类别i)* p(类别i) / p(A)</h2><ul>
<li>A:待分类数据</li>
<li><em>因为计算每个类别的概率,分母p(A)相同,所以省略</em></li>
<li>p(A|类别i) 通过已有数据计算出</li>
<li>p(类别i) 通过已有数据计算出</li>
</ul>
<p><strong>计算出哪个类别概率大,即把待分类数据标记为哪个类别</strong></p>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><ul>
<li>构建数据集矩阵和标签列表</li>
<li>训练分类器</li>
<li>将测试数据分类</li>
</ul>
<h3 id="输入"><a href="#输入" class="headerlink" title="输入:"></a>输入:</h3><blockquote>
<p>待分类向量</p>
<p>dataSet向量集合(有签[A,B,C,D,E,F…])  </p>
<p>Label =[A,B,C,D,E,F… ]</p>
</blockquote>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><ul>
<li>优点: 数据少仍有效，多分类</li>
<li>缺点: 输入数据准备方式敏感</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div></pre></td><td class="code"><pre><div class="line"><span class="string">'''</span></div><div class="line">created at 2017-05-02</div><div class="line">author:Hao Jiawei</div><div class="line">'''</div><div class="line"><span class="comment"># -*- coding:utf8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"><span class="keyword">import</span> feedparser</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">()</span>:</span></div><div class="line">    fr = open(<span class="string">'sentence'</span>)</div><div class="line">    postingList = [line.strip().split() <span class="keyword">for</span> line <span class="keyword">in</span> fr.readlines()]</div><div class="line">    <span class="comment"># 1:humiliation 0:normal</span></div><div class="line">    classVec = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</div><div class="line">    <span class="keyword">return</span> postingList, classVec</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">createVocabList</span><span class="params">(dataSet)</span>:</span></div><div class="line">    vocabSet = set([])</div><div class="line">    <span class="keyword">for</span> document <span class="keyword">in</span> dataSet:</div><div class="line">        vocabSet = vocabSet | set(document)</div><div class="line">    <span class="keyword">return</span> list(vocabSet)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 词集模型</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">setOfWordsVec</span><span class="params">(vocabList, inputSet)</span>:</span></div><div class="line">    returnVec = [<span class="number">0</span>] * len(vocabList)</div><div class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> inputSet:</div><div class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> vocabList:</div><div class="line">            returnVec[vocabList.index(word)] = <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">'the word: &#123;&#125; is not in my Vocabulary!'</span>.format(word)</div><div class="line">    <span class="keyword">return</span> returnVec</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 词袋模型</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bagOfWords2VecMN</span><span class="params">(vocabList, inputSet)</span>:</span></div><div class="line">    returnVec = [<span class="number">0</span>] * len(vocabList)</div><div class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> inputSet:</div><div class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> vocabList:</div><div class="line">            returnVec[vocabList.index(word)] += <span class="number">1</span></div><div class="line">    <span class="comment"># print 'bagOfWords2VecMN:'</span></div><div class="line">    <span class="comment"># print inputSet</span></div><div class="line">    <span class="comment"># print returnVec</span></div><div class="line">    <span class="keyword">return</span> returnVec</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    二分类。</div><div class="line">    计算(正向/负向)句子每个词在(正向/负向)中出现的概率</div><div class="line">    p(ci|w) = p(w|ci)*p(ci) / p(w)</div><div class="line">                |</div><div class="line">                |---&gt;下面代码计算这一块</div><div class="line">'''</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">trainNB0</span><span class="params">(trainMatrix, trainCategory)</span>:</span></div><div class="line">    numTrainDocs = len(trainMatrix)</div><div class="line">    numWords = len(trainMatrix[<span class="number">0</span>])</div><div class="line">    <span class="comment"># 计算文档属于哪一类的概率 p(ci)</span></div><div class="line">    pAbusive = sum(trainCategory) / float(numTrainDocs)</div><div class="line"></div><div class="line">    <span class="comment"># p0Num中性文档每个词出现的次数,若不出现则为0。以vocabList为基准</span></div><div class="line">    <span class="comment"># p0Num = zeros(numWords)</span></div><div class="line">    <span class="comment"># p1Num = zeros(numWords)</span></div><div class="line">    <span class="comment"># p0Denom = 0.0</span></div><div class="line">    <span class="comment"># p1Denom = 0.0</span></div><div class="line">    <span class="string">'''</span></div><div class="line">        利用贝叶斯分类时，一句话要被分为多个词,来计算概率然后相乘。</div><div class="line">        p(w0|ci)*p(w1|ci)*p(w2|ci)*p(w3|ci) ,如果一个词未出现概率为0.则整体为0</div><div class="line">        解决:所有词出现次数初始化为1,将出现的总次数初始化为2</div><div class="line">    '''</div><div class="line">    p0Num = ones(numWords)</div><div class="line">    p1Num = ones(numWords)</div><div class="line">    p0Denom = <span class="number">2.0</span></div><div class="line">    p1Denom = <span class="number">2.0</span></div><div class="line">    <span class="comment"># print 'numTrainDocs, numWords, pAbusive, p0Denom, p1Denom:'</span></div><div class="line">    <span class="comment"># print numTrainDocs, numWords, pAbusive, p0Denom, p1Denom</span></div><div class="line">    <span class="comment"># print 'p0Num, p1Num:'</span></div><div class="line">    <span class="comment"># print p0Num, p1Num</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numTrainDocs):</div><div class="line">        <span class="comment"># print 'i:&#123;&#125;'.format(i)</span></div><div class="line">        <span class="comment"># print 'trainMatrix[i]:'</span></div><div class="line">        <span class="comment"># print trainMatrix[i]</span></div><div class="line">        <span class="keyword">if</span> trainCategory[i] == <span class="number">1</span>:</div><div class="line">            <span class="comment"># 累加每个句子出现的词 到p1Num对应词的位置</span></div><div class="line">            p1Num += trainMatrix[i]</div><div class="line">            <span class="comment"># 累加负向所有出现的词的次数</span></div><div class="line">            p1Denom += sum(trainMatrix[i])</div><div class="line"></div><div class="line">            <span class="comment"># print 'p1Num:&#123;&#125; \n p1Denom:&#123;&#125;'.format(p1Num, p1Denom)</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            p0Num += trainMatrix[i]</div><div class="line">            p0Denom += sum(trainMatrix[i])</div><div class="line">            <span class="comment"># print 'p0Num:&#123;&#125; \n p0Denom:&#123;&#125;'.format(p0Num, p0Denom)</span></div><div class="line"></div><div class="line">    <span class="string">'''</span></div><div class="line">        为了防止出现下溢出:许多小的因子相乘,程序会得不到正确答案</div><div class="line">        解决:用对数函数.</div><div class="line">        好处:1.不会影响函数趋势 2.ln(a*b) = lna + lnb 3.缩小了数据范围</div><div class="line">    '''</div><div class="line">    <span class="comment"># 负向   该词出现的次数/总的词数</span></div><div class="line">    <span class="comment"># p1Vect = p1Num/p1Denom</span></div><div class="line">    p1Vect = log(p1Num / p1Denom)</div><div class="line">    <span class="comment"># 正向   该词出现的次数/总的词数</span></div><div class="line">    <span class="comment"># p0Vect = p0Num/p0Denom</span></div><div class="line">    p0Vect = log(p0Num / p0Denom)</div><div class="line">    <span class="comment"># print p0Vect</span></div><div class="line">    <span class="comment"># print p1Vect</span></div><div class="line">    <span class="keyword">return</span> p0Vect, p1Vect, pAbusive</div><div class="line"></div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    针对一个句子向量，用朴素贝叶斯分类</div><div class="line">    input: 句子向量, trainNB0 计算出的第一个类每个词出现的概率,</div><div class="line">    第二个类每个词出现的概率, 第一类样本占总体的概率</div><div class="line">'''</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classifyNB</span><span class="params">(vec2Classify, p0Vec, p1Vec, pClass1)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">        两个向量对应相乘,得到待分类句子每个词出现的概率</div><div class="line">        又因p1Vec,p0Vec的概率经过了log函数</div><div class="line">        所以,原本是P(w1|c1)*p(w2|c1)*...*p(wn|c1)  *  p(c1)</div><div class="line">        转换为: ln(P(w1|c1)) + ln(p(w2|c1)) +... + ln(p(wn|c1)) + ln(p(c1))</div><div class="line">    '''</div><div class="line">    p1 = sum(vec2Classify * p1Vec) + log(pClass1)</div><div class="line">    p0 = sum(vec2Classify * p0Vec) + log(<span class="number">1.0</span> - pClass1)</div><div class="line">    <span class="keyword">if</span> p1 &gt; p0:</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">testingNB</span><span class="params">()</span>:</span></div><div class="line">    listData, listClasses = loadDataSet()</div><div class="line">    vocabList = createVocabList(listData)</div><div class="line">    trainMat = []</div><div class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> listData:</div><div class="line">        trainMat.append(bagOfWords2VecMN(vocabList, doc))</div><div class="line">    p0V, p1V, pAb = trainNB0(array(trainMat), array(listClasses))</div><div class="line">    <span class="comment"># query = 'love my dalmation'</span></div><div class="line">    query = <span class="string">'garbage'</span></div><div class="line">    testEntry = query.split()</div><div class="line">    testDoc = array(setOfWordsVec(vocabList, testEntry))</div><div class="line">    <span class="keyword">print</span> <span class="string">'&#123;&#125; is classifyed as :&#123;&#125; '</span>.format(query,</div><div class="line">                                            classifyNB(testDoc, p0V, p1V, pAb))</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">textParse</span><span class="params">(bigString)</span>:</span></div><div class="line">    returnList = []</div><div class="line">    urls = re.findall(<span class="string">'\(.*?\)'</span>, bigString)</div><div class="line">    query = bigString</div><div class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</div><div class="line">        query = query.replace(url, <span class="string">''</span>)</div><div class="line">    listOfTokens = re.split(<span class="string">r'\W*'</span>, query)</div><div class="line">    <span class="comment"># print listOfTokens</span></div><div class="line">    <span class="keyword">for</span> tok <span class="keyword">in</span> listOfTokens:</div><div class="line">        <span class="keyword">if</span> len(tok) &gt; <span class="number">2</span>:</div><div class="line">            returnList.append(tok.lower())</div><div class="line">    <span class="keyword">return</span> returnList</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    测试垃圾邮件分类</div><div class="line">'''</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">spamTest</span><span class="params">()</span>:</span></div><div class="line">    docList = []  <span class="comment"># 存储每封邮件分词后的list</span></div><div class="line">    classList = []  <span class="comment"># 存储每个封邮件的label  1 --- harm  0---normal</span></div><div class="line">    fullText = []  <span class="comment"># 存储全部的词,用于做词表</span></div><div class="line"></div><div class="line">    <span class="comment"># load data</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">26</span>):</div><div class="line">        spamFilePath = <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch04\\email\\spam\\&#123;&#125;.txt'</span>.format(</div><div class="line">            i)</div><div class="line">        hamFilePath = <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch04\\email\\ham\\&#123;&#125;.txt'</span>.format(</div><div class="line">            i)</div><div class="line">        <span class="comment"># spam</span></div><div class="line">        wordList = textParse(open(spamFilePath).read())</div><div class="line">        docList.append(wordList)</div><div class="line">        fullText.extend(wordList)</div><div class="line">        classList.append(<span class="number">1</span>)</div><div class="line">        <span class="comment"># ham</span></div><div class="line">        wordList = textParse(open(hamFilePath).read())</div><div class="line">        docList.append(wordList)</div><div class="line">        fullText.extend(wordList)</div><div class="line">        classList.append(<span class="number">0</span>)</div><div class="line">    <span class="comment"># generate vocab list</span></div><div class="line">    vocabList = createVocabList(docList)</div><div class="line">    trainingSet = range(<span class="number">50</span>)</div><div class="line">    testSet = []</div><div class="line">    <span class="comment"># random generate test set</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">        randIndex = int(random.uniform(<span class="number">0</span>, len(trainingSet)))</div><div class="line">        testSet.append(trainingSet[randIndex])</div><div class="line">        <span class="keyword">del</span>(trainingSet[randIndex])</div><div class="line">    trainMat = []</div><div class="line">    trainClasses = []</div><div class="line">    <span class="comment"># wordList---&gt;vector save to trainMatrix</span></div><div class="line">    <span class="comment"># label save to trainClasses</span></div><div class="line">    <span class="keyword">for</span> docIndex <span class="keyword">in</span> trainingSet:</div><div class="line">        trainMat.append(bagOfWords2VecMN(vocabList, docList[docIndex]))</div><div class="line">        trainClasses.append(classList[docIndex])</div><div class="line">    <span class="comment"># 贝叶斯生成每个类别中每个词的概率和负向类别的概率</span></div><div class="line">    p0V, p1V, pSpam = trainNB0(array(trainMat), array(trainClasses))</div><div class="line">    errorCount = <span class="number">0</span></div><div class="line">    <span class="comment"># 测试</span></div><div class="line">    <span class="keyword">for</span> docIndex <span class="keyword">in</span> testSet:</div><div class="line">        wordVector = bagOfWords2VecMN(vocabList, docList[docIndex])</div><div class="line">        <span class="keyword">if</span> classifyNB(wordVector, p0V, p1V, pSpam) != classList[docIndex]:</div><div class="line">            errorCount += <span class="number">1</span></div><div class="line">            <span class="keyword">print</span> docList[docIndex]</div><div class="line">            <span class="keyword">print</span> <span class="string">'the right label:&#123;&#125;'</span>.format(classList[docIndex])</div><div class="line">    rate = float(errorCount) / len(testSet)</div><div class="line">    <span class="keyword">print</span> <span class="string">'the error rate is :&#123;&#125;'</span>.format(rate)</div><div class="line">    <span class="keyword">return</span> rate</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    计算出现频率最高的30个词</div><div class="line">    返回值: [(word,count),(),()...]</div><div class="line">'''</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">caclMostFreq</span><span class="params">(vocabList, fullText)</span>:</span></div><div class="line">    freqDict = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> vocabList:</div><div class="line">        freqDict[token] = fullText.count(token)</div><div class="line">    sortedFreq = sorted(freqDict.iteritems(), key=operator.itemgetter(<span class="number">1</span>),</div><div class="line">                        reverse=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">return</span> sortedFreq[:<span class="number">30</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">removeStopWords</span><span class="params">(wordList)</span>:</span></div><div class="line">    returnList = []</div><div class="line">    f = open(<span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\code\\stopWords.txt'</span>, <span class="string">'r'</span>)</div><div class="line">    stopWords = [word.strip() <span class="keyword">for</span> word <span class="keyword">in</span> f.readlines()]</div><div class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> wordList:</div><div class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopWords:</div><div class="line">            returnList.append(word)</div><div class="line">    <span class="keyword">return</span> returnList</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">localWords</span><span class="params">(feed1, feed0)</span>:</span></div><div class="line">    docList = []; classList = []; fullText = []</div><div class="line">    <span class="keyword">print</span> <span class="string">"len(feed1['entries']):&#123;&#125;  len(feed0['entries']):&#123;&#125;"</span>.format(len(feed1[<span class="string">'entries'</span>]), len(feed0[<span class="string">'entries'</span>]))</div><div class="line">    minLen = min(len(feed1[<span class="string">'entries'</span>]), len(feed0[<span class="string">'entries'</span>]))</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(minLen):</div><div class="line">        wL = textParse(feed1[<span class="string">'entries'</span>][i][<span class="string">'summary'</span>])</div><div class="line">        wordList = removeStopWords(wL)</div><div class="line">        docList.append(wordList)</div><div class="line">        fullText.extend(wordList)</div><div class="line">        classList.append(<span class="number">1</span>)</div><div class="line"></div><div class="line">        wL = textParse(feed0[<span class="string">'entries'</span>][i][<span class="string">'summary'</span>])</div><div class="line">        wordList = removeStopWords(wL)</div><div class="line">        docList.append(wordList)</div><div class="line">        fullText.extend(wordList)</div><div class="line">        classList.append(<span class="number">0</span>)</div><div class="line">    vocabList = createVocabList(docList)</div><div class="line">    top30Words = caclMostFreq(vocabList, fullText)</div><div class="line">    <span class="keyword">for</span> pairW <span class="keyword">in</span> top30Words:</div><div class="line">        <span class="keyword">if</span> pairW[<span class="number">0</span>] <span class="keyword">in</span> vocabList:</div><div class="line">            vocabList.remove(pairW[<span class="number">0</span>])</div><div class="line">    trainingSet = range(<span class="number">2</span>*minLen); testSet = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</div><div class="line">        randIndex = int(random.uniform(<span class="number">0</span>, len(trainingSet)))</div><div class="line">        testSet.append(trainingSet[randIndex])</div><div class="line">        <span class="keyword">del</span>(trainingSet[randIndex])</div><div class="line">    trainMat = []; trainClasses = []</div><div class="line">    <span class="comment"># wordList---&gt;vector save to trainMatrix</span></div><div class="line">    <span class="comment"># label save to trainClasses</span></div><div class="line">    <span class="keyword">for</span> docIndex <span class="keyword">in</span> trainingSet:</div><div class="line">        trainMat.append(bagOfWords2VecMN(vocabList, docList[docIndex]))</div><div class="line">        trainClasses.append(classList[docIndex])</div><div class="line">    <span class="comment"># 贝叶斯生成每个类别中每个词的概率和负向类别的概率</span></div><div class="line">    p0V, p1V, pSpam = trainNB0(array(trainMat), array(trainClasses))</div><div class="line">    errorCount = <span class="number">0</span></div><div class="line">    <span class="comment"># 测试</span></div><div class="line">    <span class="keyword">for</span> docIndex <span class="keyword">in</span> testSet:</div><div class="line">        wordVector = bagOfWords2VecMN(vocabList, docList[docIndex])</div><div class="line">        <span class="keyword">if</span> classifyNB(wordVector, p0V, p1V, pSpam) != classList[docIndex]:</div><div class="line">            errorCount += <span class="number">1</span></div><div class="line">            <span class="keyword">print</span> docList[docIndex]</div><div class="line">            <span class="keyword">print</span> <span class="string">'the right label:&#123;&#125;'</span>.format(classList[docIndex])</div><div class="line">    rate = float(errorCount) / len(testSet)</div><div class="line">    <span class="keyword">print</span> <span class="string">'the error rate is :&#123;&#125;'</span>.format(rate)</div><div class="line">    <span class="keyword">return</span> vocabList, p0V, p1V</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTopWords</span><span class="params">(ny, sf)</span>:</span></div><div class="line">    vocabList, p0V, p1V = localWords(ny, sf)</div><div class="line">    topNY = []; topSF = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(p0V)):</div><div class="line">        <span class="keyword">if</span> p0V[i] &gt; <span class="number">-6.0</span>:</div><div class="line">            topSF.append((vocabList[i], p0V[i]))</div><div class="line">        <span class="keyword">if</span> p1V[i] &gt; <span class="number">-6.0</span>:</div><div class="line">            topNY.append((vocabList[i], p1V[i]))</div><div class="line">    sortedSF = sorted(topSF, key=<span class="keyword">lambda</span> pair: pair[<span class="number">1</span>], reverse=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'SF**SF****SF****SF****SF****SF****SF****SF****SF****SF**'</span></div><div class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> sortedSF[:<span class="number">20</span>]:</div><div class="line">        <span class="keyword">print</span> item[<span class="number">0</span>]</div><div class="line">    sortedNY = sorted(topNY, key=<span class="keyword">lambda</span> pair:pair[<span class="number">1</span>], reverse=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'NY**NY**NY**NY**NY**NY**NY**NY**NY**NY**NY**NY**NY**NY**NY'</span></div><div class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> sortedNY[:<span class="number">20</span>]:</div><div class="line">        <span class="keyword">print</span> item[<span class="number">0</span>]</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://williams-hao.github.io/2017/06/03/决策树分类算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Williams-Hao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="所有的伟大,源于一个勇敢的开始">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/决策树分类算法/" itemprop="url">决策树分类算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T10:40:19+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习-分类/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习-分类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h1><hr>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><strong>对于待构建决策树数据集,选取其中的一个特征为划分条件(基于最大熵原则选取划分特征),来划分数据集.再对划分出的子数据集递归调用构建算法</strong><br><img src="http://ww1.sinaimg.cn/large/75544e9fly1fg7uwmsol7j20fl0btdgb.jpg" alt="决策树"></p>
<h3 id="信息增益"><a href="#信息增益" class="headerlink" title="信息增益"></a>信息增益</h3><ul>
<li><p>划分数据集的大原则:将无序的数据变得更加有序.</p>
</li>
<li><p>信息量:I[x] = log[1/P(x)] = -logP(x)</p>
</li>
<li><p>熵定义:<br><img src="http://img.blog.csdn.net/20140528165140328" alt=""></p>
</li>
<li>熵的特性</li>
</ul>
<blockquote>
<ul>
<li>熵均大于等于零，即，H_s &gt;= 0。</li>
<li>设N是系统S内的事件总数，则熵H_s&lt;= log2(N)。当且仅当p1=p2=…=pn时，等号成立，此时系统S的熵最大。</li>
</ul>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/75544e9fly1fg83t9ulx1j20kl0a70t3.jpg" alt=""></p>
<p><strong>信息增益:</strong> <em>在划分数据集之前之后信息发生的变化称为信息增益</em></p>
<blockquote>
<ul>
<li>原数据集熵-划分后数据集熵</li>
</ul>
</blockquote>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><h3 id="输入"><a href="#输入" class="headerlink" title="输入:"></a>输入:</h3><blockquote>
<p>dataSet向量集合(有签[A,B,C,D,E,F…])  </p>
<p>Label =[A,B,C,D,E,F… ]</p>
</blockquote>
<h3 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h3><blockquote>
<p>将数据集构建决策树</p>
</blockquote>
<h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ul>
<li>1.判断是否所有类别标签完全相同,是,则返回该标签</li>
<li>2.判断是否所有特征都使用完了,只剩下标签,是,则返回标签投票结果</li>
<li>3.选择一个最佳划分的特征序号bestFeat,和该序号对应的特征值bestFeatLabel</li>
<li>4.建立一个dict{bestFeatLabel:{}},把bestFeatLabel从特征列表中删除</li>
<li>5.求出bestFeatLabel所有可能的取值uniqueVals</li>
<li>6.对uniqueVals的每个值,以它为bestFeatLabel的值,划分为数据集subDataSet,<br>  递归调用创建决策树(subDataSet, 特征列表)<br>  赋值给dict{bestFeatLabel[uniqueVals该值]}</li>
<li>7.返回dict</li>
</ul>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><ul>
<li>优点: 计算复杂度不高、输出结果易于理解，对中间值缺失不敏感</li>
<li>缺点: 可能会产生过度匹配问题</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div></pre></td><td class="code"><pre><div class="line"><span class="string">'''</span></div><div class="line">created at 2017-05-02</div><div class="line">author:Hao Jiawei</div><div class="line">'''</div><div class="line"><span class="comment"># -*- coding:utf8 -*-</span></div><div class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">createDataSet</span><span class="params">()</span>:</span></div><div class="line">    dataSet = [[<span class="number">1</span>, <span class="number">1</span>, <span class="string">'yes'</span>],</div><div class="line">               [<span class="number">1</span>, <span class="number">1</span>, <span class="string">'yes'</span>],</div><div class="line">               [<span class="number">1</span>, <span class="number">0</span>, <span class="string">'no'</span>],</div><div class="line">               [<span class="number">0</span>, <span class="number">1</span>, <span class="string">'no'</span>],</div><div class="line">               [<span class="number">0</span>, <span class="number">1</span>, <span class="string">'no'</span>]]</div><div class="line">    labels = [<span class="string">'no surfacing'</span>, <span class="string">'flippers'</span>]</div><div class="line">    <span class="comment"># change to discrete values</span></div><div class="line">    <span class="keyword">return</span> dataSet, labels</div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    决策树分类(已创建的决策树, 特征列表, 待分类的向量)</div><div class="line"></div><div class="line">    已创建的决策树形如:</div><div class="line"></div><div class="line">            no surfacing</div><div class="line">            /           \</div><div class="line">           0             1</div><div class="line">          /               \</div><div class="line">         no              flippers</div><div class="line">                        /        \</div><div class="line">                       0          1</div><div class="line">                      /            \</div><div class="line">                     no             yes</div><div class="line">    1.得到树的第一个节点的特征列表的序号,和第一个特征对应的dict</div><div class="line">    2.循环dict的key,判断是否与待分类对应的特征值相同.</div><div class="line">    3.若相同,则进一步判断key对应的value是不是dict. 如果是dict 则递归再进入分类算法,返回一个分类标签</div><div class="line">    4.如果不是dict,则直接返回分类标签</div><div class="line">    5.最后返回分类标签</div><div class="line">'''</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify</span><span class="params">(inputTree, featLabels, testVec)</span>:</span></div><div class="line">    firstStr = inputTree.keys()[<span class="number">0</span>]</div><div class="line">    <span class="keyword">print</span> <span class="string">'firstStr:&#123;&#125;'</span>.format(firstStr)</div><div class="line">    secondDict = inputTree[firstStr]</div><div class="line">    featIndex = featLabels.index(firstStr)</div><div class="line">    <span class="keyword">print</span> <span class="string">'featIndex:&#123;&#125;'</span>.format(featIndex)</div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> secondDict.keys():</div><div class="line">        <span class="keyword">print</span> <span class="string">'key:&#123;&#125;'</span>.format(key)</div><div class="line">        <span class="keyword">if</span> testVec[featIndex] == key:</div><div class="line">            <span class="keyword">print</span> <span class="string">'testVec[featIndex] == key'</span></div><div class="line">            <span class="keyword">if</span> type(secondDict[key]).__name__ == <span class="string">'dict'</span>:</div><div class="line">                classLabel = classify(secondDict[key], featLabels, testVec)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                classLabel = secondDict[key]</div><div class="line">    <span class="keyword">return</span> classLabel</div><div class="line"></div><div class="line"><span class="comment"># 计算信息熵</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcShannonEnt</span><span class="params">(dataSet)</span>:</span></div><div class="line">    numEntries = len(dataSet)</div><div class="line">    labelCounts = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> featVec <span class="keyword">in</span> dataSet:</div><div class="line">        currentLabel = featVec[<span class="number">-1</span>]</div><div class="line">        <span class="keyword">if</span> currentLabel <span class="keyword">not</span> <span class="keyword">in</span> labelCounts.keys():</div><div class="line">            labelCounts[currentLabel] = <span class="number">0</span></div><div class="line">        labelCounts[currentLabel] += <span class="number">1</span></div><div class="line">    shannonEnt = <span class="number">0.0</span></div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> labelCounts:</div><div class="line">        prob = float(labelCounts[key]) / numEntries</div><div class="line">        shannonEnt -= prob * log(prob, <span class="number">2</span>)</div><div class="line">    <span class="keyword">return</span> shannonEnt</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 分割数据集</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">splitDataSet</span><span class="params">(dataSet, axis, value)</span>:</span></div><div class="line">    retDataSet = []</div><div class="line">    <span class="keyword">for</span> feacVec <span class="keyword">in</span> dataSet:</div><div class="line">        <span class="keyword">if</span> feacVec[axis] == value:</div><div class="line">            reducedFeatVec = feacVec[:axis]</div><div class="line">            reducedFeatVec.extend(feacVec[axis + <span class="number">1</span>:])</div><div class="line">            retDataSet.append(reducedFeatVec)</div><div class="line">    <span class="keyword">return</span> retDataSet</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 选一个特征,以此特征划分数据集，H=sum(每个区间概率*子区间熵) 选H最小的</span></div><div class="line"><span class="comment"># 也就是 信息增益=原数据集的熵-该特征的H  选信息增益最大的</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">chooseBestFeatureToSplit</span><span class="params">(dataSet)</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'enter chooseBestFeatureToSplit------------------------------'</span></div><div class="line">    numFeatures = len(dataSet[<span class="number">0</span>]) - <span class="number">1</span></div><div class="line">    baseEntropy = calcShannonEnt(dataSet)</div><div class="line">    bestInfoGain = <span class="number">0.0</span></div><div class="line">    bestFeature = <span class="number">-1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numFeatures):</div><div class="line">        <span class="comment"># print 'i:&#123;&#125;'.format(i)</span></div><div class="line">        featList = [example[i] <span class="keyword">for</span> example <span class="keyword">in</span> dataSet]</div><div class="line">        uniqueVals = set(featList)</div><div class="line">        <span class="comment"># print 'uniqueVals:&#123;&#125;'.format(uniqueVals)</span></div><div class="line">        newEntropy = <span class="number">0.0</span></div><div class="line">        <span class="comment"># print 'calc newEntropy:'</span></div><div class="line">        <span class="string">'''</span></div><div class="line">            若选取第一个特征作为划分</div><div class="line">            所有情况都在uniqueVals里面</div><div class="line">            遍历所有情况:</div><div class="line">            for value in uniqueVals:</div><div class="line">                当第一个特征为value时，划分的数据集为subDataSet</div><div class="line">                h(value)这种情况的熵= p * H(subDataSet)</div><div class="line">                              subDataSet占全数据集的概率 * subDataSet的熵</div><div class="line">            选取这个特征划分总的熵为:</div><div class="line">                H = h(value1) + h(value2)+ ...</div><div class="line">            选取这个特征划分的信息增益:</div><div class="line">                原数据集熵 - H</div><div class="line">        '''</div><div class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> uniqueVals:</div><div class="line">            <span class="comment"># print 'value:&#123;&#125;'.format(value)</span></div><div class="line">            subDataSet = splitDataSet(dataSet, i, value)</div><div class="line">            <span class="comment"># print 'subDataSet&#123;&#125;'.format(subDataSet)</span></div><div class="line">            prob = len(subDataSet) / float(len(dataSet))</div><div class="line">            newEntropy += prob * calcShannonEnt(subDataSet)</div><div class="line">            <span class="comment"># print 'prob:&#123;&#125; ShannonEnt:&#123;&#125;'.format(prob, calcShannonEnt(subDataSet))</span></div><div class="line">            <span class="comment"># print 'newEntropy:&#123;&#125;'.format(newEntropy)</span></div><div class="line">        infoGain = baseEntropy - newEntropy</div><div class="line">        <span class="comment"># print 'infoGain:&#123;&#125;'.format(infoGain)</span></div><div class="line">        <span class="keyword">if</span> infoGain &gt; bestInfoGain:</div><div class="line">            bestInfoGain = infoGain</div><div class="line">            bestFeature = i</div><div class="line">    <span class="keyword">print</span> <span class="string">'end chooseBestFeatureToSplit------------------------------'</span></div><div class="line">    <span class="keyword">return</span> bestFeature</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">majorityCnt</span><span class="params">(classlist)</span>:</span></div><div class="line">    classCount = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> vote <span class="keyword">in</span> classlist:</div><div class="line">        <span class="keyword">if</span> vote <span class="keyword">not</span> <span class="keyword">in</span> classCount:</div><div class="line">            classCount[vote] = <span class="number">0</span></div><div class="line">        classCount[vote] += <span class="number">1</span></div><div class="line">    sortedClassCount = sorted(classCount.items(),</div><div class="line">                              key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">return</span> sortedClassCount[<span class="number">0</span>][<span class="number">0</span>]</div><div class="line"></div><div class="line">cnt = <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">    创建决策树，参数(数据集,特征列表)</div><div class="line">        1.判断是否所有类别标签完全相同,是,则返回该标签</div><div class="line">        2.判断是否所有特征都使用完了,只剩下标签,是,则返回标签投票结果</div><div class="line">        3.选择一个最佳划分的特征序号bestFeat,和该序号对应的特征值bestFeatLabel</div><div class="line">        4.建立一个dict&#123;bestFeatLabel:&#123;&#125;&#125;,把bestFeatLabel从特征列表中删除</div><div class="line">        5.求出bestFeatLabel所有可能的取值uniqueVals</div><div class="line">        6.对uniqueVals的每个值,以它为bestFeatLabel的值,划分为数据集subDataSet,</div><div class="line">            递归调用创建决策树(subDataSet, 特征列表) 赋值给dict&#123;bestFeatLabel[uniqueVals该值]&#125;</div><div class="line">        7.返回dict</div><div class="line">'''</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">createTree</span><span class="params">(dataSet, labels)</span>:</span></div><div class="line">    <span class="keyword">global</span> cnt</div><div class="line">    cnt += <span class="number">1</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'cnt:&#123;&#125;'</span>.format(cnt)</div><div class="line">    classList = [example[<span class="number">-1</span>] <span class="keyword">for</span> example <span class="keyword">in</span> dataSet]</div><div class="line">    <span class="comment"># 所有类别标签完全相同,停止继续划分</span></div><div class="line">    <span class="keyword">if</span> classList.count(classList[<span class="number">0</span>]) == len(classList):</div><div class="line">        <span class="keyword">print</span> <span class="string">'     classList.count(classList[0]) == len(classList) return'</span></div><div class="line">        <span class="keyword">return</span> classList[<span class="number">0</span>]</div><div class="line">    <span class="comment"># 所有特征都使用完了，只剩下标签了，仍不能把数据划分成只有一个标签的分组</span></div><div class="line">    <span class="comment"># 返回一个出现最多的标签</span></div><div class="line">    <span class="keyword">if</span> len(dataSet[<span class="number">0</span>]) == <span class="number">1</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'     len(dataSet[0]) == 1 return'</span></div><div class="line">        <span class="keyword">return</span> majorityCnt(classList)</div><div class="line">    bestFeat = chooseBestFeatureToSplit(dataSet)</div><div class="line">    bestFeatLabel = labels[bestFeat]</div><div class="line">    <span class="keyword">print</span> <span class="string">'     the bestFeat:&#123;&#125; bestFeatLabel:&#123;&#125; '</span>.format(bestFeat, bestFeatLabel)</div><div class="line">    myTree = &#123;bestFeatLabel: &#123;&#125;&#125;</div><div class="line">    <span class="keyword">del</span>(labels[bestFeat])</div><div class="line">    featValues = [example[bestFeat] <span class="keyword">for</span> example <span class="keyword">in</span> dataSet]</div><div class="line">    uniqueVals = set(featValues)</div><div class="line">    <span class="keyword">print</span> <span class="string">'     uniqueVals:&#123;&#125;'</span>.format(uniqueVals)</div><div class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> uniqueVals:</div><div class="line">        subLabels = labels[:]</div><div class="line">        <span class="keyword">print</span> <span class="string">'     value:&#123;&#125;  对每个value递归调用createTree'</span>.format(value)</div><div class="line">        subDataSet = splitDataSet(dataSet, bestFeat, value)</div><div class="line">        <span class="keyword">print</span> <span class="string">'     subDataSet:&#123;&#125;'</span>.format(subDataSet)</div><div class="line">        myTree[bestFeatLabel][value] = createTree(</div><div class="line">            splitDataSet(dataSet, bestFeat, value), subLabels)</div><div class="line">    <span class="keyword">return</span> myTree</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">storeTree</span><span class="params">(inputTree, filename)</span>:</span></div><div class="line">    <span class="keyword">import</span> pickle</div><div class="line">    fw = open(filename, <span class="string">'w'</span>)</div><div class="line">    pickle.dump(inputTree, fw)</div><div class="line">    fw.close()</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">grabTree</span><span class="params">(filename)</span>:</span></div><div class="line">    <span class="keyword">import</span> pickle</div><div class="line">    fr = open(filename)</div><div class="line">    <span class="keyword">return</span> pickle.load(fr)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://williams-hao.github.io/2017/06/03/KNN分类算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Williams-Hao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="所有的伟大,源于一个勇敢的开始">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/03/KNN分类算法/" itemprop="url">KNN分类算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T10:00:20+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="KNN"><a href="#KNN" class="headerlink" title="KNN"></a>KNN</h1><hr>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><strong>对于无标签的待分类数据,通过计算和带标签的数据集的相似度,选出前K个最相似的数据.把这K个数据中出现次数最多的分类作为待分类数据的类别返回.</strong></p>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><h3 id="输入"><a href="#输入" class="headerlink" title="输入:"></a>输入:</h3><blockquote>
<p>dataSet向量集合(有签[A,B,C,D,E,F…])  </p>
<p>Label =[A,B,C,D,E,F… ]</p>
<p>X待分类向量</p>
<p>K值</p>
</blockquote>
<h3 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h3><blockquote>
<p>将X分类到某个类别[A,B,C,..]</p>
</blockquote>
<h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ul>
<li>1、计算X到dataSet每个向量的距离-&gt;distances(欧式距离)</li>
<li>2、distances按照升序排列，得到一个index List</li>
<li>3、取前K个index List的值作为序号，拿到Label对应序号的标签。存入一个dict中<label,count></label,count></li>
<li>4、对dict按照count降序排列，输出第一个的label。（即：距离X最近的K个向量的标签中，出现最多的那个标签）</li>
</ul>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><ul>
<li>优点: 精度高、对异常值不敏感、无输入数据假定</li>
<li>缺点: 计算复杂度高、空间复杂度高</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line"><span class="string">'''</span></div><div class="line">created at 2017-05-02</div><div class="line">author:Hao Jiawei</div><div class="line">'''</div><div class="line"><span class="comment"># -*- coding:utf8 -*-</span></div><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">createDataSet</span><span class="params">()</span>:</span></div><div class="line">    group = array([[<span class="number">1.0</span>, <span class="number">1.1</span>], [<span class="number">1.0</span>, <span class="number">1.0</span>], [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0.1</span>]])</div><div class="line">    label = [<span class="string">'A'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'B'</span>]</div><div class="line">    <span class="keyword">return</span> group, label</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify0</span><span class="params">(inX, dataSet, labels, k)</span>:</span></div><div class="line">    dataSetSize = dataSet.shape[<span class="number">0</span>]</div><div class="line">    diffMat = tile(inX, (dataSetSize, <span class="number">1</span>)) - dataSet</div><div class="line">    sqDiffMat = diffMat**<span class="number">2</span></div><div class="line">    sqDistances = sqDiffMat.sum(axis=<span class="number">1</span>)</div><div class="line">    distances = sqDistances**<span class="number">0.5</span></div><div class="line">    sortedDistIndicies = distances.argsort()</div><div class="line">    classCount = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k):</div><div class="line">        voteIlabel = labels[sortedDistIndicies[i]]</div><div class="line">        classCount[voteIlabel] = classCount.get(voteIlabel, <span class="number">0</span>) + <span class="number">1</span></div><div class="line">    sortedClassCount = sorted(classCount.iteritems(),</div><div class="line">                              key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">return</span> sortedClassCount[<span class="number">0</span>][<span class="number">0</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span><span class="params">(filename)</span>:</span></div><div class="line">    fr = open(filename)</div><div class="line">    numberOfLines = len(fr.readlines())  <span class="comment"># get the number of lines in the file</span></div><div class="line">    returnMat = zeros((numberOfLines, <span class="number">3</span>))  <span class="comment"># prepare matrix to return</span></div><div class="line">    classLabelVector = []  <span class="comment"># prepare labels return</span></div><div class="line">    fr = open(filename)</div><div class="line">    index = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> fr.readlines():</div><div class="line">        line = line.strip()</div><div class="line">        listFromLine = line.split(<span class="string">'\t'</span>)</div><div class="line">        returnMat[index, :] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</div><div class="line">        classLabelVector.append(int(listFromLine[<span class="number">-1</span>]))</div><div class="line">        index += <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> returnMat, classLabelVector</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">autoNorm</span><span class="params">(dataSet)</span>:</span></div><div class="line">    minVals = dataSet.min(<span class="number">0</span>)</div><div class="line">    maxVals = dataSet.max(<span class="number">0</span>)</div><div class="line">    ranges = maxVals - minVals</div><div class="line">    <span class="keyword">print</span> <span class="string">'minVals:&#123;&#125;'</span>.format(minVals)</div><div class="line">    <span class="keyword">print</span> <span class="string">'maxVals:&#123;&#125;'</span>.format(maxVals)</div><div class="line">    <span class="keyword">print</span> <span class="string">'ranges:&#123;&#125;'</span>.format(ranges)</div><div class="line">    normDataSet = zeros(shape(dataSet))</div><div class="line">    m = dataSet.shape[<span class="number">0</span>]</div><div class="line">    normDataSet = dataSet - tile(minVals, (m, <span class="number">1</span>))</div><div class="line">    normDataSet = normDataSet / tile(ranges, (m, <span class="number">1</span>))  <span class="comment"># element wise divide</span></div><div class="line">    <span class="keyword">return</span> normDataSet, ranges, minVals</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">datingClassTest</span><span class="params">()</span>:</span></div><div class="line">    hoRatio = <span class="number">0.10</span></div><div class="line">    datingDataMat, datingLabels = file2matrix(</div><div class="line">        <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch02\\datingTestSet2.txt'</span>)</div><div class="line">    normMat, ranges, minVals = autoNorm(datingDataMat)</div><div class="line">    m = normMat.shape[<span class="number">0</span>]</div><div class="line">    numTestVecs = int(m * hoRatio)</div><div class="line">    errorCount = <span class="number">0.0</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(numTestVecs):</div><div class="line">        classiferResult = classify0(normMat[i, :], normMat[numTestVecs:m, :],</div><div class="line">                                    datingLabels[numTestVecs:m], <span class="number">3</span>)</div><div class="line">        <span class="keyword">print</span> <span class="string">'the classifer came back with: &#123;&#125;, the real answer is: &#123;&#125;'</span>\</div><div class="line">            .format(classiferResult, datingLabels[i])</div><div class="line">        <span class="keyword">if</span> classiferResult != datingLabels[i]:</div><div class="line">            errorCount += <span class="number">1.0</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'the total error reate is : &#123;&#125;'</span>\</div><div class="line">        .format(errorCount / float(numTestVecs))</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">classifyPerson</span><span class="params">()</span>:</span></div><div class="line">    resultList = [<span class="string">'not at all'</span>, <span class="string">'in small doses'</span>, <span class="string">'in large doses'</span>]</div><div class="line">    percentTats = float(raw_input(</div><div class="line">        <span class="string">"perentange of time spend playing video games?"</span>))</div><div class="line">    ffMiles = float(raw_input(<span class="string">"frequent flier miles earned per year?"</span>))</div><div class="line">    iceCream = float(raw_input(<span class="string">"liters of ice cream consumed per year?"</span>))</div><div class="line">    datingDataMat, datingLabels = file2matrix(</div><div class="line">        <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch02\\datingTestSet2.txt'</span>)</div><div class="line">    normMat, ranges, minVals = autoNorm(datingDataMat)</div><div class="line">    inArr = array([ffMiles, percentTats, iceCream])</div><div class="line">    classiferResult = classify0(</div><div class="line">        (inArr - minVals) / ranges, normMat, datingLabels, <span class="number">3</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'you will probably like this person : &#123;&#125;'</span>\</div><div class="line">        .format(resultList[classiferResult - <span class="number">1</span>])</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">img2vector</span><span class="params">(filename)</span>:</span></div><div class="line">    returnVect = zeros((<span class="number">1</span>, <span class="number">1024</span>))</div><div class="line">    fr = open(filename)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>):</div><div class="line">        line = fr.readline()</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">32</span>):</div><div class="line">            returnVect[<span class="number">0</span>, <span class="number">32</span> * i + j] = int(line[j])</div><div class="line">    <span class="keyword">return</span> returnVect</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handwritingClassTest</span><span class="params">()</span>:</span></div><div class="line">    trainingDir = <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch02\\trainingDigits'</span></div><div class="line">    testDir = <span class="string">'D:\\IT_software\\python_code\\MachineLearningInAction\\machinelearninginaction\\Ch02\\testDigits'</span></div><div class="line">    hwLabels = []</div><div class="line">    trainingFileList = listdir(trainingDir)</div><div class="line">    m = len(trainingFileList)</div><div class="line">    trainingMat = zeros((m, <span class="number">1024</span>))</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</div><div class="line">        fileNameStr = trainingFileList[i]</div><div class="line">        fileStr = fileNameStr.split(<span class="string">'.'</span>)[<span class="number">0</span>]</div><div class="line">        classNumStr = int(fileStr.split(<span class="string">'_'</span>)[<span class="number">0</span>])</div><div class="line">        hwLabels.append(classNumStr)</div><div class="line">        trainingMat[i, :] = img2vector(</div><div class="line">            <span class="string">'&#123;&#125;\\&#123;&#125;'</span>.format(trainingDir, fileNameStr))</div><div class="line">    testFileList = listdir(testDir)</div><div class="line">    errorCount = <span class="number">0.0</span></div><div class="line">    mTest = len(testFileList)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(mTest):</div><div class="line">        fileNameStr = testFileList[i]</div><div class="line">        fileStr = fileNameStr.split(<span class="string">'.'</span>)[<span class="number">0</span>]</div><div class="line">        classNumStr = int(fileStr.split(<span class="string">'_'</span>)[<span class="number">0</span>])</div><div class="line">        vectorUnderTest = img2vector(<span class="string">'&#123;&#125;\\&#123;&#125;'</span>.format(testDir, fileNameStr))</div><div class="line">        classifierResult = classify0(vectorUnderTest,</div><div class="line">                                     trainingMat, hwLabels, <span class="number">3</span>)</div><div class="line">        <span class="keyword">print</span> <span class="string">'the classifier came back with: &#123;&#125;, the real answer is :&#123;&#125;'</span> \</div><div class="line">            .format(classifierResult, classNumStr)</div><div class="line">        <span class="keyword">if</span> classifierResult != classNumStr :</div><div class="line">            errorCount += <span class="number">1.0</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'the total number of eror is :&#123;&#125;'</span>.format(errorCount)</div><div class="line">    <span class="keyword">print</span> <span class="string">'the total number of test is :&#123;&#125;'</span>.format(mTest)</div><div class="line">    <span class="keyword">print</span> <span class="string">'the total error rate is :&#123;&#125;'</span>.format(errorCount/float(mTest))</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://williams-hao.github.io/2017/05/11/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Williams-Hao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="所有的伟大,源于一个勇敢的开始">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/11/test/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-11T16:04:51+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h2 id="titile-test"><a href="#titile-test" class="headerlink" title="titile:test"></a>titile:test</h2><h1 id="hello"><a href="#hello" class="headerlink" title="hello"></a>hello</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://williams-hao.github.io/2017/05/11/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Williams-Hao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="所有的伟大,源于一个勇敢的开始">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/11/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-11T15:36:08+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Williams-Hao" />
          <p class="site-author-name" itemprop="name">Williams-Hao</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Williams-Hao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
